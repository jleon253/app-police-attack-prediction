<mat-stepper #stepper linear>
  <mat-step [stepControl]="infoForm">
    <form [formGroup]="infoForm" class="container">
      <ng-template matStepLabel>Datos Personales</ng-template>
      <div class="d-flex flex-column gap-4">
        <div class="form-group">
          <label for="nombre">Nombre de la Persona:</label>
          <input
            type="text"
            class="form-control"
            id="nombre"
            formControlName="nombre"
          />
        </div>

        <div class="form-group">
          <label for="edad">Edad:</label>
          <input
            type="number"
            min="0"
            class="form-control"
            id="edad"
            formControlName="edad"
          />
        </div>

        <div class="form-group">
          <label for="genero">Genero:</label>
          <ng-select
            formControlName="genero"
            [multiple]="false"
            [searchable]="true"
            [items]="textUI.genero"
          >
            <ng-template ng-label-tmp let-item="item">
              {{ item.genero }}
            </ng-template>
            <ng-template ng-option-tmp let-item="item">
              {{ item.genero }}
            </ng-template>
          </ng-select>
        </div>

        <div class="form-group">
          <label for="raza">Raza:</label>
          <ng-select
            formControlName="raza"
            [multiple]="false"
            [searchable]="true"
            [items]="textUI.raza"
          >
            <ng-template ng-label-tmp let-item="item">
              {{ item.raza }}
            </ng-template>
            <ng-template ng-option-tmp let-item="item">
              {{ item.raza }}
            </ng-template>
          </ng-select>
        </div>

        <div class="form-group">
          <label for="direccion">Direcciòn u Observaciòn</label>
          <input
            type="text"
            class="form-control"
            id="direccion"
            formControlName="direccion"
          />
        </div>

        <div class="form-group">
          <label for="ubicacionExacta">Ubicaciòn Exacta:</label>
          <ng-select
            formControlName="ubicacionExacta"
            [multiple]="false"
            [searchable]="true"
            [items]="textUI.ubicacionExacta"
          >
            <ng-template ng-label-tmp let-item="item">
              {{ item.ubicacionExacta }}
            </ng-template>
            <ng-template ng-option-tmp let-item="item">
              {{ item.ubicacionExacta }}
            </ng-template>
          </ng-select>
        </div>

        <div class="form-group">
          <label for="enfer_mental">Enfermedad Mental:</label>
          <ng-select
            formControlName="enfer_mental"
            [multiple]="false"
            [searchable]="true"
            [items]="textUI.enfer_mental"
          >
            <ng-template ng-label-tmp let-item="item">
              {{ item.enfer_mental }}
            </ng-template>
            <ng-template ng-option-tmp let-item="item">
              {{ item.enfer_mental }}
            </ng-template>
          </ng-select>
        </div>
      </div>

      <div>
        <button
          mat-raised-button
          matStepperNext
          color="primary"
          [disabled]="!infoForm.valid"
        >
          {{ textUI.buttons.next }}
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="issueForm">
    <form [formGroup]="issueForm" class="container">
      <ng-template matStepLabel>Incidente</ng-template>

      <div class="form-group">
        <label for="armadoCon">Armado con:</label>
        <ng-select
          formControlName="armadoCon"
          [multiple]="false"
          [searchable]="true"
          [items]="textUI.armadoCon"
        >
          <ng-template ng-label-tmp let-item="item">
            {{ item.armadoCon }}
          </ng-template>
          <ng-template ng-option-tmp let-item="item">
            {{ item.armadoCon }}
          </ng-template>
        </ng-select>
      </div>

      <div class="form-group">
        <label for="estadoHuida">Estado de Huida</label>
        <ng-select
          formControlName="estadoHuida"
          [multiple]="false"
          [searchable]="true"
          [items]="textUI.estadoHuida"
        >
          <ng-template ng-label-tmp let-item="item">
            {{ item.estadoHuida }}
          </ng-template>
          <ng-template ng-option-tmp let-item="item">
            {{ item.estadoHuida }}
          </ng-template>
        </ng-select>
      </div>

      <div class="form-group">
        <label for="tipoAmenaza">Tipo de Amenaza:</label>
        <ng-select
          formControlName="tipoAmenaza"
          [multiple]="false"
          [searchable]="true"
          [items]="textUI.tipamenaza"
        >
          <ng-template ng-label-tmp let-item="item">
            {{ item.tipamenaza }}
          </ng-template>
          <ng-template ng-option-tmp let-item="item">
            {{ item.tipamenaza }}
          </ng-template>
        </ng-select>
      </div>

      <div class="form-group">
        <label for="maneraMorir">Manera de Morir:</label>
        <ng-select
          formControlName="maneraMorir"
          [multiple]="false"
          [searchable]="true"
          [items]="textUI.maneraMorir"
        >
          <ng-template ng-label-tmp let-item="item">
            {{ item.maneraMorir }}
          </ng-template>
          <ng-template ng-option-tmp let-item="item">
            {{ item.maneraMorir }}
          </ng-template>
        </ng-select>
      </div>

      <div class="d-flex gap-4">
        <button mat-raised-button matStepperPrevious>
          {{ textUI.buttons.back }}
        </button>
        <button
          mat-raised-button
          matStepperNext
          color="primary"
          [disabled]="!issueForm.valid"
        >
          {{ textUI.buttons.next }}
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="policeForm">
    <form [formGroup]="policeForm" class="container">
      <ng-template matStepLabel>Agente policial</ng-template>

      <div class="form-group">
        <label for="camaraCorporal">Camara Corporal en el policia:</label>
        <ng-select
          formControlName="camaraCorporal"
          [multiple]="false"
          [searchable]="true"
          [items]="textUI.camaraCorporal"
        >
          <ng-template ng-label-tmp let-item="item">
            {{ item.camaraCorporal }}
          </ng-template>
          <ng-template ng-option-tmp let-item="item">
            {{ item.camaraCorporal }}
          </ng-template>
        </ng-select>
      </div>

      <div class="form-group">
        <label for="idAgencias">Agencia</label>
        <ng-select
          formControlName="idAgencias"
          [multiple]="false"
          [searchable]="true"
          [items]="agenciesList"
          [searchFn]="agencySearchFn"
        >
          <ng-template ng-label-tmp let-item="item">
            {{ item.nombre }}
          </ng-template>
          <ng-template ng-option-tmp let-item="item">
            {{ item.nombre }}
          </ng-template>
        </ng-select>
      </div>

      <div class="d-flex gap-4">
        <button mat-raised-button matStepperPrevious>
          {{ textUI.buttons.back }}
        </button>
        <button
          mat-raised-button
          matStepperNext
          color="primary"
          [disabled]="!policeForm.valid"
        >
          {{ textUI.buttons.next }}
        </button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="modelForm">
    <form [formGroup]="modelForm" (ngSubmit)="onSubmit()" class="container">
      <ng-template matStepLabel>Predicción</ng-template>

      <div class="form-group">
        <label for="model">Modelo a usar:</label>
        <ng-select
          formControlName="model"
          [multiple]="false"
          [searchable]="true"
          [items]="textUI.model"
        >
          <ng-template ng-label-tmp let-item="item">
            {{ item }}
          </ng-template>
          <ng-template ng-option-tmp let-item="item">
            {{ item }}
          </ng-template>
        </ng-select>
      </div>

      <div class="d-flex gap-4">
        <button mat-raised-button matStepperPrevious>
          {{ textUI.buttons.back }}
        </button>
        <button
          mat-raised-button
          matStepperNext
          color="primary"
          type="submit"
          [disabled]="!modelForm.valid"
        >
          {{ textUI.buttons.predict }}
        </button>
      </div>
    </form>
  </mat-step>
</mat-stepper>

<div #exampleModal class="modal fade" id="exampleModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Respuesta: {{ selectedModel }}
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body text-center" [ngClass]="{
        'text-bg-success': resPredict === 'No',
        'text-bg-danger': resPredict === 'Si'
      }">
        <h1>{{ resPredict }}</h1>
        <p>
          Esta persona {{ resPredict }} sufrió abuso por parte de la policia.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
